{"version":3,"sources":["components/Uploader.js","components/Tips.js","pages/Home.js"],"names":["Dragger","Upload","Result","styled","div","H1","h1","Image","img","A","a","Input","input","Component","observer","useStores","ImageStore","UserStore","ref1","useRef","ref2","store","useLocalStore","width","setWidth","height","setHeight","serverFile","attributes","url","widthStr","heightStr","props","showUploadList","beforeUpload","file","setFile","setFilename","name","currentUser","message","warning","window","test","type","size","error","upload","then","success","console","log","catch","tip","spinning","isUpLoading","className","InboxOutlined","target","href","onClick","document","createElement","value","style","position","left","body","appendChild","focus","select","execCommand","removeChild","bind","filename","src","ref","onChange","current","placeholder","fullStr","Tips","children","Home","Uploader"],"mappings":"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","file":"static/js/9.e573f340.chunk.js","sourcesContent":["import React, { useRef } from 'react'\r\nimport { useStores } from '../stores'\r\nimport { observer, useLocalStore } from 'mobx-react'\r\nimport { Upload, message, Spin, Button } from 'antd'\r\nimport { InboxOutlined } from '@ant-design/icons'\r\nimport styled from 'styled-components'\r\n\r\n\r\nconst { Dragger } = Upload\r\n\r\nconst Result = styled.div`\r\n    margin-top: 30px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 10px;\r\n    border-shadow: 0 0 0 4px rgba(0, 0 ,0, .3);\r\n    background: #fff;\r\n    /* opacity: .8; */\r\n    padding: 20px;\r\n`\r\nconst H1 = styled.h1`\r\n    margin: 20px 0;\r\n    text-align: center;\r\n`\r\nconst Image = styled.img`\r\n    margin-top:10px;\r\n    max-width: 300px;\r\n`\r\nconst A = styled.a`\r\n    margin-left: 10px;\r\n`\r\n\r\nconst Input = styled.input`\r\n    outline: none;\r\n    margin-right: 10px;\r\n    margin-top: 10px;\r\n\r\n`\r\n\r\n\r\n//  observer 观察这个组件   监控组件变化\r\nconst Component = observer(() => {\r\n    const { ImageStore, UserStore } = useStores()\r\n    const ref1 = useRef()\r\n    const ref2 = useRef()\r\n\r\n    // 箭头函数的返回值是一个整体\r\n    const store = useLocalStore(() => ({\r\n        width: null,\r\n        setWidth(width) {\r\n            store.width = width\r\n        },\r\n        get widthStr() {\r\n            return store.width ? `/w/${store.width}` : ''\r\n        },\r\n        height: null,\r\n        setHeight(height) {\r\n            store.height = height\r\n        },\r\n        get heightStr() {\r\n            return store.height ? `/h/${store.height}` : ''\r\n        },\r\n        get fullStr() {\r\n            //?imageView2/0/w/800/h/400)\r\n            return ImageStore.serverFile.attributes.url.attributes.url + '?imageView2/0' + store.widthStr + store.heightStr\r\n        }\r\n    }))\r\n    // 复制图片地址\r\n    const bundleCopy = (url) => {\r\n        let input = document.createElement('textarea')\r\n        input.value = url\r\n        input.style.position = 'absolute';\r\n        input.style.left = '-9999px';\r\n        document.body.appendChild(input);\r\n        input.focus()\r\n        input.select()\r\n        if (document.execCommand('Copy')) {\r\n            document.execCommand('Copy')\r\n            message.success('复制成功')\r\n        } else {\r\n            message.error('复制失败,请通过在线预览手动复制')\r\n\r\n        }\r\n        document.body.removeChild(input);\r\n    }\r\n\r\n\r\n    const bindWidthChange = () => {\r\n        store.setWidth(ref1.current.value)\r\n    }\r\n    const bindHeightChange = () => {\r\n        store.setHeight(ref2.current.value)\r\n    }\r\n\r\n    const props = {\r\n        showUploadList: false,  //是否展示文件列表\r\n        beforeUpload: file => {\r\n            ImageStore.setFile(file)\r\n            ImageStore.setFilename(file.name)\r\n            if (UserStore.currentUser === null) {\r\n                message.warning('请先登录再上传！')\r\n                return false\r\n            }\r\n            // 判断文件格式,  window.file = file 是将file放置到全局中\r\n            window.file = file\r\n            if (!/(svg$)|(png$)|(jpg$)|(jpeg$)|(gif$)/ig.test(file.type)) {//ig 忽略大小写\r\n                message.error('只能上传svg/png/jpg/jpeg/gif格式的图片')\r\n                return false\r\n            }\r\n            // 判断文件大小\r\n            if (file.size > 2 * 1024 * 1024) {\r\n                message.error('图片最大2M')\r\n                return false\r\n            }\r\n\r\n            ImageStore.upload()\r\n                .then((serverFile) => {\r\n                    message.success('上传成功')\r\n                    console.log(serverFile);\r\n                }).catch(() => {\r\n                    message.error('上传失败')\r\n                })\r\n            return false\r\n        }\r\n    }\r\n\r\n\r\n    return (\r\n        <div>\r\n            <Spin tip='上传中' spinning={ImageStore.isUpLoading}>\r\n                <Dragger {...props}>\r\n                    <p className=\"ant-upload-drag-icon\"> <InboxOutlined /> </p>\r\n                    <p className=\"ant-upload-text\">点击或者拖拽上传图片</p>\r\n                    <p className=\"ant-upload-hint\">\r\n                        仅支持.svg/.png/.jpg/.jpeg/.gif 格式的图片，图片最大2M\r\n                    </p>\r\n                </Dragger>\r\n            </Spin>\r\n            {\r\n                ImageStore.serverFile ? <Result>\r\n                    <H1>上传结果</H1>\r\n                    <dl>\r\n                        <dt>线上地址</dt>\r\n                        <dd>\r\n                            <a target='_blank' href={ImageStore.serverFile.attributes.url.attributes.url}>点击查看</a>\r\n                            <Button type=\"primary\" onClick={bundleCopy.bind(null, ImageStore.serverFile.attributes.url.attributes.url)}>复制图片链接</Button>\r\n                        </dd>\r\n\r\n                        <dt>文件名: </dt>\r\n                        <dd>{ImageStore.filename}</dd>\r\n\r\n                        <dt >图片预览</dt>\r\n                        <dd> <Image src={ImageStore.serverFile.attributes.url.attributes.url} /> </dd>\r\n\r\n                        <dt>更多尺寸</dt>\r\n                        <dd>\r\n                            <Input ref={ref1} onChange={bindWidthChange} placeholder='最大宽度（可选）' />\r\n                            <Input ref={ref2} onChange={bindHeightChange} placeholder='最大高度（可选）' />\r\n                            <A target='_blank' href={store.fullStr} >点击查看图片</A>\r\n                        </dd>\r\n                    </dl>\r\n                </Result> : null\r\n\r\n            }\r\n        </div>\r\n    )\r\n})\r\nexport default Component","import React from 'react'\r\nimport { useStores } from '../stores'\r\nimport { observer } from 'mobx-react'\r\nimport styled from 'styled-components'\r\n\r\nconst Tips = styled.div`\r\n    background: red;\r\n    padding: 10px; \r\n    margin: 30px 0;\r\n    color: #fff;\r\n    border-radius: 4px;\r\n    text-align: center;\r\n`\r\nconst H1 = styled.h1`\r\n    background: green;\r\n    font-size: 16px;\r\n    padding: 10px; \r\n    margin: 30px 0;\r\n    color: #fff;\r\n    border-radius: 4px;\r\n    text-align: center;\r\n`\r\nconst Component = observer(({children}) => {\r\n\r\n    const { UserStore } = useStores()\r\n\r\n    return(\r\n        <>\r\n            {\r\n                UserStore.currentUser ? <H1>登录成功，可以上传图片啦</H1> : <Tips>{children}</Tips>\r\n            }  \r\n\r\n        </>\r\n    )\r\n})\r\n\r\nexport default Component","import React from 'react'\r\nimport { observer } from 'mobx-react'\r\nimport { useStores } from '../stores'\r\nimport Uploader from '../components/Uploader'\r\nimport Tips from '../components/Tips'\r\nimport styled from 'styled-components'\r\n\r\n\r\nconst A = styled.a`\r\n    color: #fff;\r\n`\r\n\r\nconst Home = observer(() => {\r\n    const { UserStore } = useStores()\r\n\r\n    const User = () => <div> hello {UserStore.currentUser.attributes.username} </div>\r\n\r\n    return (\r\n        <>\r\n            <Tips children> <A href=\"/login\">请先登录再上传</A>  </Tips>\r\n\r\n            <Uploader />\r\n        </>\r\n    )\r\n})\r\nexport default Home\r\n"],"sourceRoot":""}